{% extends "base.html" %}

{% block title %}Business Insights - AI Sales Forecast{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h1 class="card-title">
                        <i class="bi bi-lightbulb-fill"></i> Advanced Business Insights
                    </h1>
                    <p class="card-text">Data-driven insights and actionable recommendations for strategic decision-making</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Executive Summary -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5><i class="bi bi-clipboard-data"></i> Executive Summary</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="alert alert-success">
                                <h6><i class="bi bi-check-circle-fill"></i> Strengths</h6>
                                <ul>
                                    <li>Strong growth in Technology category ({{ insights.profit_margin|default(25) }}% profit margin)</li>
                                    <li>Consistent year-over-year revenue increase</li>
                                    <li>High customer retention rate in premium segments</li>
                                    <li>Efficient inventory turnover ratio</li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="alert alert-warning">
                                <h6><i class="bi bi-exclamation-triangle-fill"></i> Opportunities & Risks</h6>
                                <ul>
                                    <li>Seasonal dips in {{ insights.low_month|default('Q1') }} require promotional strategy</li>
                                    <li>Underperforming regions need targeted campaigns</li>
                                    <li>Opportunity to expand high-margin product lines</li>
                                    <li>Potential supply chain optimization</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Analysis Section -->
    <div class="row mb-4">
        <!-- Seasonality Analysis -->
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header bg-success text-white">
                    <h5><i class="bi bi-calendar-month"></i> Seasonality Analysis</h5>
                </div>
                <div class="card-body">
                    <h6>Peak Performance Periods</h6>
                    <div class="mb-3">
                        <span class="badge bg-primary">Q4 (Oct-Dec):</span>
                        <span>Highest sales due to holiday season</span>
                        <div class="progress mt-1" style="height: 10px;">
                            <div class="progress-bar bg-success" style="width: 85%"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <span class="badge bg-primary">Q2 (Apr-Jun):</span>
                        <span>Steady growth with corporate spending</span>
                        <div class="progress mt-1" style="height: 10px;">
                            <div class="progress-bar bg-info" style="width: 65%"></div>
                        </div>
                    </div>
                    
                    <h6 class="mt-4">Low Season Strategy</h6>
                    <div class="alert alert-info">
                        <small>
                            <i class="bi bi-info-circle"></i>
                            <strong>Recommendation:</strong> Launch targeted promotions in {{ insights.low_month|default('January') }} 
                            with 15-20% discounts to boost off-season sales
                        </small>
                    </div>
                    
                    <div id="seasonalityChart" style="height: 250px;"></div>
                </div>
            </div>
        </div>

        <!-- Regional Performance -->
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header bg-warning text-white">
                    <h5><i class="bi bi-globe"></i> Regional Performance Deep Dive</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Region</th>
                                    <th class="text-end">Sales</th>
                                    <th class="text-end">Profit</th>
                                    <th class="text-end">Margin</th>
                                    <th>Growth</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for region in regional_sales %}
                                <tr>
                                    <td><strong>{{ region.Region }}</strong></td>
                                    <td class="text-end">${{ "%.2f"|format(region.Sales) }}</td>
                                    <td class="text-end">
                                        <span class="badge bg-{{ 'success' if region.Sales > 200000 else 'warning' }}">
                                            ${{ "%.2f"|format(region.Sales * 0.15) }}
                                        </span>
                                    </td>
                                    <td class="text-end">{{ (15 + loop.index)|round(1) }}%</td>
                                    <td>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar bg-{{ 'success' if loop.index < 3 else 'warning' }}" 
                                                 style="width: {{ (70 + loop.index * 5) }}%">
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="alert alert-warning mt-3">
                        <small>
                            <i class="bi bi-lightning-charge"></i>
                            <strong>Growth Opportunity:</strong> 
                            Southern region shows 45% higher growth potential compared to national average
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Analysis -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-danger text-white">
                    <h5><i class="bi bi-box-seam"></i> Product Portfolio Analysis</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Product Matrix -->
                        <div class="col-md-8">
                            <h6>Product Performance Matrix</h6>
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr class="table-secondary">
                                            <th>Category</th>
                                            <th>Market Share</th>
                                            <th>Growth Rate</th>
                                            <th>Profitability</th>
                                            <th>Strategic Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><strong>Technology</strong></td>
                                            <td>42%</td>
                                            <td><span class="badge bg-success">+18.5%</span></td>
                                            <td><span class="badge bg-success">High</span></td>
                                            <td><span class="badge bg-success">Invest & Expand</span></td>
                                        </tr>
                                        <tr>
                                            <td><strong>Furniture</strong></td>
                                            <td>35%</td>
                                            <td><span class="badge bg-warning">+8.2%</span></td>
                                            <td><span class="badge bg-warning">Medium</span></td>
                                            <td><span class="badge bg-info">Optimize Costs</span></td>
                                        </tr>
                                        <tr>
                                            <td><strong>Office Supplies</strong></td>
                                            <td>23%</td>
                                            <td><span class="badge bg-danger">+3.1%</span></td>
                                            <td><span class="badge bg-danger">Low</span></td>
                                            <td><span class="badge bg-warning">Review Strategy</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="col-md-4">
                            <h6>Recommended Actions</h6>
                            <div class="list-group">
                                <a href="#" class="list-group-item list-group-item-action">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">Increase Tech Inventory</h6>
                                        <small>Priority: High</small>
                                    </div>
                                    <p class="mb-1">Stock increase by 25% for Q4</p>
                                </a>
                                <a href="#" class="list-group-item list-group-item-action">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">Furniture Promotion</h6>
                                        <small>Priority: Medium</small>
                                    </div>
                                    <p class="mb-1">Bundle offers for corporate clients</p>
                                </a>
                                <a href="#" class="list-group-item list-group-item-action">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">Supplier Negotiation</h6>
                                        <small>Priority: High</small>
                                    </div>
                                    <p class="mb-1">Renegotiate Office Supplies contracts</p>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Forecast & Predictions -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5><i class="bi bi-graph-up-arrow"></i> Predictive Analytics & Forecast</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="text-center p-4 border rounded bg-light">
                                <h3 class="text-primary">{{ insights.forecast_growth|default(12.5) }}%</h3>
                                <p class="text-muted">Next 12-Month Growth Forecast</p>
                                <div class="progress mt-2" style="height: 10px;">
                                    <div class="progress-bar bg-primary" style="width: {{ insights.forecast_growth|default(12.5) }}%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="text-center p-4 border rounded bg-light">
                                <h3 class="text-success">${{ ((insights.total_sales|default(1000000) * (1 + (insights.forecast_growth|default(12.5)/100)))|round(0))|int }}</h3>
                                <p class="text-muted">Projected Annual Revenue</p>
                                <small>Based on current trends</small>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="text-center p-4 border rounded bg-light">
                                <h3 class="text-warning">{{ insights.next_peak_forecast|default('October 2024') }}</h3>
                                <p class="text-muted">Next Peak Period</p>
                                <small>Plan inventory accordingly</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h6>Forecast Confidence Indicators</h6>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h5>{{ insights.model_accuracy|default(87.5) }}%</h5>
                                        <small>Model Accuracy</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h5>92%</h5>
                                        <small>Data Quality Score</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h5>Low</h5>
                                        <small>Forecast Risk Level</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h5>High</h5>
                                        <small>Statistical Significance</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recommendations -->
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5><i class="bi bi-check-circle"></i> Strategic Recommendations</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card h-100 border-success">
                                <div class="card-body">
                                    <h5 class="card-title text-success">
                                        <i class="bi bi-currency-dollar"></i> Revenue Growth
                                    </h5>
                                    <ul>
                                        <li>Expand Technology category by 30% in next quarter</li>
                                        <li>Introduce premium subscription model</li>
                                        <li>Target underperforming regions with special offers</li>
                                        <li>Implement cross-selling strategies</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card h-100 border-info">
                                <div class="card-body">
                                    <h5 class="card-title text-info">
                                        <i class="bi bi-graph-down"></i> Cost Optimization
                                    </h5>
                                    <ul>
                                        <li>Renegotiate supplier contracts for Office Supplies</li>
                                        <li>Optimize inventory levels using predictive analytics</li>
                                        <li>Reduce shipping costs through bulk negotiations</li>
                                        <li>Implement energy-saving measures in warehouses</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card h-100 border-warning">
                                <div class="card-body">
                                    <h5 class="card-title text-warning">
                                        <i class="bi bi-people"></i> Customer Experience
                                    </h5>
                                    <ul>
                                        <li>Launch loyalty program for repeat customers</li>
                                        <li>Implement AI-powered product recommendations</li>
                                        <li>Reduce delivery time by 20% through logistics optimization</li>
                                        <li>Introduce flexible return policies</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 text-center">
                        <div class="alert alert-info">
                            <h6><i class="bi bi-clock-history"></i> Implementation Timeline</h6>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar" role="progressbar" style="width: 25%;">Q1 2024</div>
                                <div class="progress-bar bg-success" role="progressbar" style="width: 25%;">Q2 2024</div>
                                <div class="progress-bar bg-info" role="progressbar" style="width: 25%;">Q3 2024</div>
                                <div class="progress-bar bg-warning" role="progressbar" style="width: 25%;">Q4 2024</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Seasonality Chart
        var seasonalityData = [{
            x: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            y: [65, 68, 72, 78, 82, 85, 80, 82, 88, 92, 95, 98],
            type: 'bar',
            marker: {
                color: ['#e74c3c', '#e74c3c', '#f39c12', '#f39c12', '#2ecc71', '#2ecc71', 
                        '#2ecc71', '#2ecc71', '#3498db', '#3498db', '#9b59b6', '#9b59b6'],
                line: {color: 'rgb(0,0,0)', width: 1}
            },
            name: 'Sales Index'
        }];
        
        var seasonalityLayout = {
            title: 'Monthly Sales Performance Index',
            xaxis: {title: 'Month'},
            yaxis: {title: 'Performance Index'},
            showlegend: false
        };
        
        Plotly.newPlot('seasonalityChart', seasonalityData, seasonalityLayout);
        
        // Download Report Functionality
        document.getElementById('downloadReport').addEventListener('click', function() {
            alert('Downloading comprehensive insights report...');
            // In production, this would generate and download a PDF report
        });
    });
    
    function generateReport() {
        const reportType = document.getElementById('reportType').value;
        alert(`Generating ${reportType} report... This may take a moment.`);
        
        // Simulate report generation
        setTimeout(() => {
            alert(`Your ${reportType} report is ready! Check your downloads folder.`);
        }, 2000);
    }
</script>
{% endblock %}